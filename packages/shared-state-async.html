<!DOCTYPE html>
<html>
  
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-language" content="en">

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>shared-state-async | LibreMesh</title>
  <meta name="description" content="">
  <meta name="author" content="LibreMesh">
  <meta name="theme-color" content="black">    
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
  <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="canonical" href="/packages/shared-state-async.html">
  <link rel="alternate" type="application/rss+xml" title="LibreMesh" href="/feed.xml">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">      
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">  
  <link rel="shortcut icon" href="/assets/logo/logo_nano.png"> 

  <link rel="stylesheet" href="/assets/css/font-awesome.min.css">
  <link rel="stylesheet" href="/assets/css/asciidoctor.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/palette.css">
  <link rel="stylesheet" href="/assets/css/style.css">
  <script src="/assets/js/main.js"></script>


  <body dir="ltr" data-md-color-primary="black" data-md-color-accent="black" class="no-toc">
    
    <svg class="md-svg">
  <defs>
    <path d="M160 304q0 10-3.125 20.5t-10.75 19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75 19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360 304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25 2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75 1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75 0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5 46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z" fill="currentColor"></path>
  </defs>
</svg>

<input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off>
<input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off>
<label class=md-overlay data-md-component=overlay for=__drawer></label> <a href="#shared-state-async" tabindex=1 class=md-skip> Skip to content </a>

<header class=md-header data-md-component=header>
  <nav class="md-header-nav md-grid">
    <div class=md-flex>
      <div class="md-flex__cell md-flex__cell--shrink">
        <a class="md-header-nav__button md-logo" href="" title="LibreMesh">
          <img height="" src="/assets/logo/logo_nano.png" width=""></a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
          <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
          <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> 
              <span class=md-header-nav__topic><a href="">LibreMesh</a></span>
              <span class=md-header-nav__topic>shared-state-async</span>
          </div>
      </div>

      <!-- lang --> 
      <div class="md-flex__cell md-flex__cell--shrink md-grid">
        <ul style="display: flex" class="lng md-tabs__list">
          
          
          
          
          
            <li class="md-tabs__item " style="padding: 0 .5rem">
              <a href="/packages/shared-state-async.html" class="md-tabs__link en lng-active ">EN</a>
            </li>
          
              </ul>
      </div>
      <!-- fine lang-->

      <div class="md-flex__cell md-flex__cell--shrink">
          
          <label class="md-icon md-icon--search md-header-nav__button" for=__search></label>
          <div class=md-search data-md-component=search role=dialog>
              <label class=md-search__overlay for=__search></label>
              <div class=md-search__inner role=search>
                  <form class=md-search__form name=search>
                      <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active>
                      <label class="md-icon md-search__icon" for=__search></label>
                      <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button>
                  </form>
                  <div class=md-search__output>
                      <div class=md-search__scrollwrap data-md-scrollfix>
                          <div class=md-search-result data-md-component=result>
                              <div class=md-search-result__meta> Type to start searching </div>
                              <ol class=md-search-result__list></ol>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
          
      </div>

      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          <a class="md-source" data-md-source="github" href="https://github.com/libremesh/lime-packages" title="Go to repository">
          <div class="md-source__icon" style="padding-top:5px">
            <i class="fa-brands fa-github fa-3x"></i>
          </div>
          <div class="md-source__repository">
            libremesh/lime-packages
          </div></a>
        </div>
      </div>
    </div>
    <div class="top-nav md-flex hs no-scrollbar" style="background-color: #333;">
    <ul class="md-tabs__list">

    <!-- Use the current language and default to english if doc translation is not found -->
    
    
    
    <li class="md-tabs__item ">
        <a class="md-tabs__link" href="/">Home</a>
    </li>

    <!-- Use the current language and default to english if doc translation is not found -->
    
    
    
    <li class="md-tabs__item ">
        <a class="md-tabs__link" href="/about.html">About</a>
    </li>

    <!-- Use the current language and default to english if doc translation is not found -->
    
    
    
    <li class="md-tabs__item ">
        <a class="md-tabs__link" href="/news.html">News</a>
    </li>

    <!-- Use the current language and default to english if doc translation is not found -->
    
    
    
    <li class="md-tabs__item ">
        <a class="md-tabs__link" href="/communication.html">Communication</a>
    </li>

    <!-- Use the current language and default to english if doc translation is not found -->
    
    
    
    <li class="md-tabs__item ">
        <a class="md-tabs__link" href="/getit.html">Get it!</a>
    </li>

    <!-- Use the current language and default to english if doc translation is not found -->
    
    
    
    <li class="md-tabs__item ">
        <a class="md-tabs__link" href="/howitworks.html">How it works</a>
    </li>

    <!-- Use the current language and default to english if doc translation is not found -->
    
    
    
    <li class="md-tabs__item ">
        <a class="md-tabs__link" href="/development.html">Development</a>
    </li>

    </ul>

</div>
  </nav>
</header>


    <div class="md-container"> 
        <main class="md-main">
            <div class="md-main__inner md-grid" data-md-component="container">
              <!-- <div class="intersection-rect"></div>     -->

            <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
  <div class="md-sidebar__scrollwrap">
    <div class="md-sidebar__inner">
      <nav class="md-nav md-nav--primary" data-md-level="0">
        <ul class="md-nav__list" data-md-scrollfix="">

          <li class="md-nav__item caption">
  <strong class="text-grey">Documentation</strong>
</li>
<!-- Use the current language and default to english if doc translation is not found -->
 
    
    
    
      <li class="md-nav__item 
        
        ">
      
        <a class="md-nav__link" href="/docs/">
          <i class="fa fa-book" aria-hidden="true"></i>
          <span>LibreMesh Documentation</span>
        </a>
      
      </li>
  
    
    
    
      <li class="md-nav__item 
         md-nav__item--nested 
        ">
      
        <a class="md-nav__link  " style="display:flex;justify-content: space-between;" 
            href="/docs/en_quick_starting_guide.html">
          <div style="display:flex;justify-content: flex-start;">
            <i class="fa fa-rocket" aria-hidden="true"></i>
            <span>Quick Starting Guide</span>
          </div>
          <span style="text-align: right"><i class="fa fa-chevron-right" aria-hidden="true"></i></span>
        </a>
        <ul class="md-nav__list " data-md-scrollfix="">
          
            
            
            
            <li class="md-nav__item ">
              <a class="md-nav__link" href="/docs/en_connecting_nodes.html"> 
                <span>Connecting to LibreMesh nodes</span>
              </a>
            </li>
          
            
            
            
            <li class="md-nav__item ">
              <a class="md-nav__link" href="/docs/quick_start_guide/en_cli_configuration.html"> 
                <span>CLI configuration</span>
              </a>
            </li>
          
          </ul>
      
      </li>
  
    
    
    
      <li class="md-nav__item 
         md-nav__item--nested 
        ">
      
        <a class="md-nav__link  " style="display:flex;justify-content: space-between;" 
            href="/docs/en_config.html">
          <div style="display:flex;justify-content: flex-start;">
            <i class="fa fa-cogs" aria-hidden="true"></i>
            <span>Configuration</span>
          </div>
          <span style="text-align: right"><i class="fa fa-chevron-right" aria-hidden="true"></i></span>
        </a>
        <ul class="md-nav__list " data-md-scrollfix="">
          
            
            
            
            <li class="md-nav__item ">
              <a class="md-nav__link" href="/docs/configuration/faq-and-recommendations.html"> 
                <span>FAQ and recommendations</span>
              </a>
            </li>
          
            
            
            
            <li class="md-nav__item ">
              <a class="md-nav__link" href="/docs/configuration/lime-example.html"> 
                <span>lime-example</span>
              </a>
            </li>
          
          </ul>
      
      </li>
  
    
    
    
      <li class="md-nav__item 
        
        ">
      
        <a class="md-nav__link" href="/docs/en_changing_network_behavior.html">
          <i class="fa fa-ethernet" aria-hidden="true"></i>
          <span>Change Ethernet config</span>
        </a>
      
      </li>
  
    
    
    
      <li class="md-nav__item 
        
        ">
      
        <a class="md-nav__link" href="/docs/en_change_wifi_behavior.html">
          <i class="fa fa-wifi" aria-hidden="true"></i>
          <span>Change WiFi config</span>
        </a>
      
      </li>
  
    
    
    
      <li class="md-nav__item 
        
        ">
      
        <a class="md-nav__link" href="/docs/en_troubleshooting.html">
          <i class="fa fa-wrench" aria-hidden="true"></i>
          <span>Troubleshooting</span>
        </a>
      
      </li>
  
    
    
    
      <li class="md-nav__item 
         md-nav__item--nested 
        ">
      
        <a class="md-nav__link  " style="display:flex;justify-content: space-between;" 
            href="/docs/hardware/">
          <div style="display:flex;justify-content: flex-start;">
            <i class="fa fa-microchip" aria-hidden="true"></i>
            <span>Hardware</span>
          </div>
          <span style="text-align: right"><i class="fa fa-chevron-right" aria-hidden="true"></i></span>
        </a>
        <ul class="md-nav__list " data-md-scrollfix="">
          
            
            
            
            <li class="md-nav__item ">
              <a class="md-nav__link" href="/docs/hardware/tp-link.html"> 
                <span>tp-link</span>
              </a>
            </li>
          
            
            
            
            <li class="md-nav__item ">
              <a class="md-nav__link" href="/docs/hardware/xiaomi-miwifir3.html"> 
                <span>Xiaomi MiWiFi R3</span>
              </a>
            </li>
          
          </ul>
      
      </li>
  
          



  <li class="md-nav__item 
     md-nav__item--nested  
    
    ">
  
    <a class="md-nav__link  " 
    style="display: flex; justify-content: space-between;" 
    href="/development.html">
      <div>
        <i class="fa fa-brands fa-linux" aria-hidden="true"></i>
        <span>Development</span>
      </div>
      <span style="text-align: right"><i class="fa fa-chevron-right" aria-hidden="true"></i></span>
    </a>
    <ul class="md-nav__list " data-md-scrollfix="">
      
        
        
        
        <li class="md-nav__item ">
          <a class="md-nav__link" href="/development-network_profiles.html"> 
            <span>Network Profiles</span>
          </a>
        </li>
      
        
        
        
        <li class="md-nav__item ">
          <a class="md-nav__link" href="/development-kernel_vermagic.html"> 
            <span>Kernel vermagic</span>
          </a>
        </li>
      
      </ul>
  
  </li>

          <li class="md-nav__item md-nav__item--nested 
 md-nav__item--nested-open ">
  <a class="md-nav__link  " 
    style="display: flex; justify-content: space-between" 
    href="/packages/#">
    <div>
      <i class="fa fa-cube" aria-hidden="true"></i>
      <span>Packages</span>
    </div>
    <span style="text-align: right"><i class="fa fa-chevron-right" aria-hidden="true"></i></span>
  </a>
  <ul class="md-nav__list md-nav__list-open " data-md-scrollfix="">
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/altermundi-grafana.html">
          <span>altermundi-grafana</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/auto-usb-wwan.html">
          <span>auto-usb-wwan</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/babeld-auto-gw-mode.html">
          <span>babeld-auto-gw-mode</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/bandwidth-test.html">
          <span>bandwidth-test</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/batman-adv-auto-gw-mode.html">
          <span>batman-adv-auto-gw-mode</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/bmx7-auto-gw-bw-mode.html">
          <span>bmx7-auto-gw-bw-mode</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/bmx7-auto-gw-mode.html">
          <span>bmx7-auto-gw-mode</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/bmx7-mdns.html">
          <span>bmx7-mdns</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/check-date-http.html">
          <span>check-date-http</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/check-internet.html">
          <span>check-internet</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/cotonete.html">
          <span>cotonete</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/deferrable-reboot.html">
          <span>deferrable-reboot</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/eupgrade.html">
          <span>eupgrade</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/first-boot-wizard.html">
          <span>first-boot-wizard</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/hotplug-initd-services.html">
          <span>hotplug-initd-services</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/packages_list.html">
          <span>packages_list</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-ap-watchping.html">
          <span>lime-ap-watchping</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-app.html">
          <span>lime-app</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-curtigghio.html">
          <span>lime-curtigghio</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-debug.html">
          <span>lime-debug</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-docs.html">
          <span>lime-docs</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-eth-config.html">
          <span>lime-eth-config</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-hwd-ground-routing.html">
          <span>lime-hwd-ground-routing</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-hwd-openwrt-wan.html">
          <span>lime-hwd-openwrt-wan</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-hwd-usbradio.html">
          <span>lime-hwd-usbradio</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-hwd-watchcat.html">
          <span>lime-hwd-watchcat</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-proto-anygw.html">
          <span>lime-proto-anygw</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-proto-babeld.html">
          <span>lime-proto-babeld</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-proto-batadv.html">
          <span>lime-proto-batadv</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-proto-bgp.html">
          <span>lime-proto-bgp</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-proto-bmx7.html">
          <span>lime-proto-bmx7</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-proto-olsr.html">
          <span>lime-proto-olsr</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-proto-olsr2.html">
          <span>lime-proto-olsr2</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-proto-olsr6.html">
          <span>lime-proto-olsr6</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-proto-wan.html">
          <span>lime-proto-wan</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-report.html">
          <span>lime-report</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-smart-wifi.html">
          <span>lime-smart-wifi</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/lime-system.html">
          <span>lime-system</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/miniserver-client.html">
          <span>miniserver-client</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/pirania.html">
          <span>pirania</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/prometheus-node-exporter-lua-location-latlon.html">
          <span>prometheus-node-exporter-lua-location-latlon</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/prometheus-node-exporter-lua-wifi-params.html">
          <span>prometheus-node-exporter-lua-wifi-params</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/prometheus-node-exporter-lua-wifi-stations-extra.html">
          <span>prometheus-node-exporter-lua-wifi-stations-extra</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/prometheus-node-exporter-lua-wifi-survey.html">
          <span>prometheus-node-exporter-lua-wifi-survey</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/prometheus-node-push-influx.html">
          <span>prometheus-node-push-influx</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/random-numgen.html">
          <span>random-numgen</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/safe-reboot.html">
          <span>safe-reboot</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/safe-upgrade.html">
          <span>safe-upgrade</span>
        </a>
      </li>
    
      <li class="md-nav__item md-nav__item--active ">
        <a class="md-nav__link" href="/packages/shared-state-async.html">
          <span>shared-state-async</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/shared-state-babel_links_info.html">
          <span>shared-state-babel_links_info</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/shared-state-babeld_hosts.html">
          <span>shared-state-babeld_hosts</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/shared-state-bat_hosts.html">
          <span>shared-state-bat_hosts</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/shared-state-bat_links_info.html">
          <span>shared-state-bat_links_info</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/shared-state-dnsmasq_hosts.html">
          <span>shared-state-dnsmasq_hosts</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/shared-state-dnsmasq_leases.html">
          <span>shared-state-dnsmasq_leases</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/shared-state-dnsmasq_servers.html">
          <span>shared-state-dnsmasq_servers</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/shared-state-network_nodes.html">
          <span>shared-state-network_nodes</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/shared-state-node_info.html">
          <span>shared-state-node_info</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/shared-state-nodes_and_links.html">
          <span>shared-state-nodes_and_links</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/shared-state-persist.html">
          <span>shared-state-persist</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/shared-state-pirania.html">
          <span>shared-state-pirania</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/shared-state-ref_state_commons.html">
          <span>shared-state-ref_state_commons</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/shared-state-wifi_links_info.html">
          <span>shared-state-wifi_links_info</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/shared-state.html">
          <span>shared-state</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/soporteremoto.html">
          <span>soporteremoto</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/sprunge.html">
          <span>sprunge</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/ubus-lime-batman-adv.html">
          <span>ubus-lime-batman-adv</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/ubus-lime-groundrouting.html">
          <span>ubus-lime-groundrouting</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/ubus-lime-location.html">
          <span>ubus-lime-location</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/ubus-lime-metrics.html">
          <span>ubus-lime-metrics</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/ubus-lime-openairview.html">
          <span>ubus-lime-openairview</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/ubus-lime-utils.html">
          <span>ubus-lime-utils</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/ubus-tmate.html">
          <span>ubus-tmate</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/watchping.html">
          <span>watchping</span>
        </a>
      </li>
    
      <li class="md-nav__item">
        <a class="md-nav__link" href="/packages/wifi-unstuck-wa.html">
          <span>wifi-unstuck-wa</span>
        </a>
      </li>
    
  </ul>
</li>
          <li class="md-nav__item caption">
    <strong class="text-grey">Links</strong>
</li>
<li class="md-nav__item">
    <a class="md-nav__link" href="https://downloads.libremesh.org/current/">
    <div>
        <i class="fa fa-download" aria-hidden="true"></i>
        <span>Latest Release Firmware</span>
    </div>
    </a>
</li>
<li class="md-nav__item">
    <a class="md-nav__link" href="https://github.com/libremesh/">
    <div>
        <i class="fa fa-code-fork" aria-hidden="true"></i>
        <span>Source Code</span>
    </div>
    </a>
</li>
<li class="md-nav__item">
    <a class="md-nav__link" href="https://www.autistici.org/mailman/listinfo/libremesh">
    <div>
        <i class="fa fa-envelope" aria-hidden="true"></i>
        <span>Mailing List</span>
    </div>
    </a>
</li>
<li class="md-nav__item">
    <a class="md-nav__link" href="https://matrix.to/#/#libremesh-dev:matrix.guifi.net">
    <div>
        <i class="fa fa-comments" aria-hidden="true"></i>
        <span>Element Chatroom</span>
    </div>
    </a>
</li>
      
        </ul>
      </nav>
    </div>
  </div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
  <div class="md-sidebar__scrollwrap">
    <div class="md-sidebar__inner">
      <nav class="md-nav md-nav--secondary">
        <p class="md-nav__title text-grey">Table of contents</p>
        <!-- toc will be appended here!-->
        <ul class="md-nav__list" id="nav_toc"><li class="md-nav__item"><a href="#readme" class="md-nav__link">Readme</a></li><li class="md-nav__item"><a href="#makefile" class="md-nav__link">Makefile</a></li></ul>
        </ul>
      </nav>
    </div>
  </div>
</div>

                <div id="md-container-pancakes">
                <div class="md-content"> 
    <article class="md-content__inner md-typeset">
      <h1 id="shared-state-async" style="margin-bottom:0px">shared-state-async</h1>
      <a href="https://github.com/libremesh/lime-packages/blob/master/packages/shared-state-async">https://github.com/libremesh/lime-packages/blob/master/packages/shared-state-async</a>

<div class="packages-container">
<div class="sect1">
<h2 id="readme">Readme</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>= LibreMesh: Shared State Overview<br>
:toc:<br>
:toclevels: 3</p>
</div>
<div class="paragraph">
<p>== Introduction</p>
</div>
<div class="paragraph">
<p>LibreMesh is an open-source framework designed to facilitate the creation of community mesh networks. A key component of this framework is the <strong>Shared State</strong>, a Conflict-Free Replicated Data Type (CRDT) daemon. This module enables seamless information exchange between nodes in a decentralized network, ensuring consistency and reliability.</p>
</div>
<div class="paragraph">
<p>The official repository is: <a href="https://github.com/LibreMesh/shared-state-async" class="bare">https://github.com/LibreMesh/shared-state-async</a>.</p>
</div>
<div class="paragraph">
<p>Features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Conflict-Free Synchronization</strong>: Shared State ensures data consistency across nodes without requiring a central authority or lock mechanism.</p>
</li>
<li>
<p><strong>Decentralized Communication</strong>: Nodes exchange data directly, allowing the network to function even in the absence of a central controller.</p>
</li>
<li>
<p><strong>Flexible Data Types</strong>: Supports various data types, including Wi-Fi link information, node details, and more.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>== Available Commands</p>
</div>
<div class="paragraph">
<p>Shared State provides several commands to interact with and manage data types. Below is an overview of the most commonly used commands for getting and managing data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>shared-state-async
Usage: shared-state-async OPERATION [ARGUMENTS]
Supported operations: discover, dump, get, insert, peer, register, sync</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Get</strong></p>
</div>
<div class="paragraph">
<p>In LibreMesh, shared-state is already included and running so you can run this command. This command allows you to retrieve the current state of a specific data type.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>shared-state-async get &lt;data_type&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>shared-state-async get net-stats</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Insert</strong></p>
</div>
<div class="paragraph">
<p>This command is used to insert data into Shared State. You can specify the data type and the information you want to insert using std input.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{}' | shared-state-async insert &lt;data_type&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>echo '{"cheche":{"src_loc":{"long":"-64.4228178","lat":"-31.8019512"},"links":{"ae40411f73a8c64a00fc3abe":{"freq":2462,"iface":"wlan0-mesh","tx_rate":144400,"dst_mac":"c6:4a:00:fc:3a:be","channel":11,"chains":[-40,-35],"signal":-34,"rx_rate":144400,"src_mac":"ae:40:41:1f:73:a8"}}}}'| shared-state-async insert wifi_links_info_ref</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Dump</strong></p>
</div>
<div class="paragraph">
<p>Is like get but with extended shared state debug info of a datatype. It will report "Author"             and "Ttl"</p>
</div>
<div class="literalblock">
<div class="content">
<pre>shared-state-async dump &lt;data_type&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>shared-state-async get bat-hosts
{
...
    "ae:40:41:22:55:78": "estela_y_julio_wlan1_mesh_17",
    "ae:40:41:22:55:7b": "estela_y_julio_wlan2_mesh"
}


shared-state-async dump bat-hosts

...

    {
        "key": "ae:40:41:22:55:78",
        "value": {
            "mAuthor": "estela-y-julio",
            "mTtl": {
                "xint64": 1422,
                "xstr64": "1422"
            },
            "mData": "estela_y_julio_wlan1_mesh_17"
        }
    },
    {
        "key": "ae:40:41:22:55:7b",
        "value": {
            "mAuthor": "estela-y-julio",
            "mTtl": {
                "xint64": 1422,
                "xstr64": "1422"
            },
            "mData": "estela_y_julio_wlan2_mesh"
        }
    }
...</pre>
</div>
</div>
<div class="paragraph">
<p><strong>sync</strong></p>
</div>
<div class="paragraph">
<p>This is used to force synchronization between nodes. It will try to sync with neighbors but you can also specify a specific host to try to sync to.<br>
In order to get the most accurate and fresh info from a node you must force the publisher of the data type to be executed and then sync your info with that node.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    shared-state-async sync bat-hots 8.8.8.8</pre>
</div>
</div>
<div class="paragraph">
<p><strong>peer</strong></p>
</div>
<div class="paragraph">
<p>Shared state is basically only one binary that has to be called first with the "peer" argument in order to lunch the daemon. Then the same binary can be used as a tool to interact with the daemon.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>shared-state-async peer</pre>
</div>
</div>
<div class="paragraph">
<p><strong>discover</strong></p>
</div>
<div class="paragraph">
<p>Discover the nodes able to parte in the Shared State network.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>shared-state-async discover</pre>
</div>
</div>
<div class="paragraph">
<p><strong>register</strong></p>
</div>
<div class="paragraph">
<p>Register a new data type or node in the Shared State system.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>shared-state-async register DATA-TYPE TYPE-SCOPE UPDATE-INTERVAL BLEACH-TTL</pre>
</div>
</div>
<div class="paragraph">
<p>== Ubus Wrapper</p>
</div>
<div class="paragraph">
<p>Shared State also supports using ubus for remote procedure calls (RPC) to interact with the system. Get method returns shared-state "get" json data or reported error in case no json is found. Errors are bubbled up as they come from shared-state inside a json structure with the name "error".</p>
</div>
<div class="paragraph">
<p>Available commands are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nl">"sync"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"data_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"str"</span><span class="p">,</span><span class="w"> </span><span class="nl">"peers_ip"</span><span class="p">:</span><span class="w"> </span><span class="s2">"str"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"get"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"data_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"str"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"publish"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"data_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"str"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"publish_all"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"insert"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"data_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"str"</span><span class="p">,</span><span class="w"> </span><span class="nl">"json"</span><span class="p">:</span><span class="w"> </span><span class="s2">"str"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>=== Get</p>
</div>
<div class="paragraph">
<p>Get bat-hosts</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ubus -S call shared-state-async get "{'data_type': 'bat-hosts'}"

{"a8:40:41:1f:73:ab":"lrsegundo_eth1_2","02:95:39:1f:73:aa":"lrsegundo_eth0_250","a8:40:41:1c:85:c3":"lrsegundo_wlan2_mesh","a8:40:41:1c:85:16":"lrsegundo_wlan1_mesh","02:bb:ed:1f:73:aa":"lrsegundo_eth1_250","a8:40:41:1f:73:a8":"lrsegundo_wlan0_ap","aa:40:41:1f:73:a8":"lrsegundo_wlan0_apname","02:db:d6:1f:73:aa":"lrsegundo_eth0_1_250","02:29:0f:1f:73:aa":"lrsegundo_eth1_2_250","c2:10:20:5e:7f:b3":"lrsegundo_bat0","a8:40:41:1f:73:aa":"lrsegundo_eth0"}</pre>
</div>
</div>
<div class="paragraph">
<p>Get an invalid data type</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ubus -S call shared-state-async get "{'data_type': 'bat-hosss'}"

{"error":53248}</pre>
</div>
</div>
<div class="paragraph">
<p>=== Sync<br>
Sync valid data type</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ubus -S call shared-state-async sync "{'data_type': 'bat-hosts'}"

{"error":0}</pre>
</div>
</div>
<div class="paragraph">
<p>Sync invalid data type</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ubus -S call shared-state-async sync "{'data_type': 'bat-hoss' }"

{"error":53248}</pre>
</div>
</div>
<div class="paragraph">
<p>Sync valid data type with unreachable ipv4 addresses</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ubus -S call shared-state-async sync "{'data_type': 'bat-hosts' ,'peers_ip':['10.0.0.1','10.0.0.2']}'"

{"error":32768}</pre>
</div>
</div>
<div class="paragraph">
<p>Sync valid data type with invalid ipv4 address</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ubus -S call shared-state-async sync "{'data_type': 'bat-hosts' ,'peers_ip':['10.0.0.1','10.0.2']}'"

{"error":61952}</pre>
</div>
</div>
<div class="paragraph">
<p>Sync invalid data type with specified ipv4 address</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ubus -S call shared-state-async sync "{'data_type': 'bat-hosts' ,'peers_ip':['127.0.0.1','127.0.0.1']}'"

{"error":53248}</pre>
</div>
</div>
<div class="paragraph">
<p>Sync valid data type with reachable ipv4 addresses</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ubus -S call shared-state-async sync "{'data_type': 'bat-hosts' ,'peers_ip':['127.0.0.1','127.0.0.1']}'"

{"error":0}</pre>
</div>
</div>
<div class="paragraph">
<p>== Data types<br>
Each data type in Shared State consists of at least two key components:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Definition</strong>: Specifies the structure and properties of the data type.</p>
</li>
<li>
<p><strong>Publisher</strong>: Responsible for generating and updating the data.</p>
</li>
<li>
<p><strong>Hook(optional)</strong>: optionally a data type can implement a third component that is a hook. These executes custom actions when the data type is updated or accessed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>all data types are in a separate package in LibreMesh and are named "shared-state-<strong>dataType</strong>". A good example of a package is <a href="https://github.com/LibreMesh/lime-packages/tree/08784318f4e9fd4269675bd9dbc8ebf6962ce5da/packages/shared-state-bat_hosts">bat-hosts</a></p>
</div>
<div class="paragraph">
<p>=== Available data types</p>
</div>
<div class="paragraph">
<p>Shared State uses data types to support various functions. Each data types is responsible for handling a specific information, ensuring seamless integration and management of that data within the mesh network.</p>
</div>
<div class="paragraph">
<p>The some of the currently supported data types include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>bat-hosts</strong>: Handles information about hosts in the network and helps resolving node&#8217;s domain name.</p>
</li>
<li>
<p><strong>wifi_links_info</strong>: Handles information about Wi-Fi link status and metrics.</p>
</li>
<li>
<p><strong>node_info</strong>: Manages metadata about individual nodes.</p>
</li>
<li>
<p><strong>babel_links_info</strong>: babel routing protocol-specific link data.</p>
</li>
<li>
<p><strong>bat_links_info</strong>: Manages link information for BATMAN-adv networks.</p>
</li>
<li>
<p><strong>Reference State</strong>: One application of Shared State is maintaining a reference state for troubleshooting, diagnostics, and disaster recovery in mesh networks. Refer to the detailed documentation in <a href="https://github.com/LibreMesh/lime-packages/blob/08784318f4e9fd4269675bd9dbc8ebf6962ce5da/packages/shared-state-ref_state_commons/README.md">README.md</a> for more on Reference State.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>=== Data types registration</p>
</div>
<div class="paragraph">
<p>To add support for a new data type, you can develop a custom new data type tailored to your requirements. Data types must be registered into shared-state-async by using a config file. UCI infrastructure is preferred and here is a sample</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">mSc</span><span class="o">=</span><span class="s2">"plugin_name"</span>

uci <span class="nb">set </span>shared-state.<span class="k">${</span><span class="nv">mSc</span><span class="k">}</span><span class="o">=</span>dataType
uci <span class="nb">set </span>shared-state.<span class="k">${</span><span class="nv">mSc</span><span class="k">}</span>.name<span class="o">=</span><span class="s1">'data_type_name'</span>
uci <span class="nb">set </span>shared-state.<span class="k">${</span><span class="nv">mSc</span><span class="k">}</span>.scope<span class="o">=</span><span class="s1">'community'</span>
uci <span class="nb">set </span>shared-state.<span class="k">${</span><span class="nv">mSc</span><span class="k">}</span>.ttl<span class="o">=</span><span class="s1">'1200'</span>
uci <span class="nb">set </span>shared-state.<span class="k">${</span><span class="nv">mSc</span><span class="k">}</span>.update_interval<span class="o">=</span><span class="s1">'120'</span>
uci commit shared-state</code></pre>
</div>
</div>
<div class="paragraph">
<p>'name' and 'ttl' are the most important attributes.'name' is the name of the data type and 'ttl' parameter stands for "time to live" and will decrease every second until 0.</p>
</div>
<div class="paragraph">
<p>=== Datatype publishers</p>
</div>
<div class="paragraph">
<p>In Shared State, <strong>publishers</strong> are responsible for producing and updating data. Each publisher acts as a source for specific data types, feeding information into the system that is then distributed and replicated across the network.</p>
</div>
<div class="paragraph">
<p>Publishers must be located at /usr/share/shared-state/publishers<br>
All Publishers will be called periodically using shared-state-async-publish-all, this can also be invoked manually.</p>
</div>
<div class="paragraph">
<p>Sync is called automatically by shared-state daemon every 15s<br>
"ttl" parameter stands for "time to live" and will decrease every second until 0.<br>
Data contents will be erased if "ttl" reaches 0. So calling publishers has to be done periodically before that happens.</p>
</div>
<div class="paragraph">
<p>=== Datatype hooks</p>
</div>
<div class="paragraph">
<p><strong>Datatype hooks</strong> allow custom behavior to be triggered when specific data types are updated or accessed. These hooks enable developers to extend the functionality of Shared State by defining actions that respond to changes in the data.</p>
</div>
<div class="paragraph">
<p>Examples of hooks in action can be found in the <code>shared-state-mesh-upgrade</code> package. This package demonstrates how hooks can be utilized to enhance mesh network functionalities.</p>
</div>
<div class="paragraph">
<p>=== Adding Hooks</p>
</div>
<div class="paragraph">
<p>Hooks can be added by defining callback script tied to specific data types.</p>
</div>
<div class="paragraph">
<p>hooks scripts must be placed in /usr/share/shared-state/hooks/dataType folder and must read std input as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="lua"><span class="kd">local</span> <span class="n">indata</span> <span class="o">=</span> <span class="nb">io.stdin</span><span class="p">:</span><span class="n">read</span><span class="p">(</span><span class="s2">"*all"</span><span class="p">)</span>
<span class="n">utils</span><span class="p">.</span><span class="n">printJson</span><span class="p">(</span><span class="n">JSON</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">indata</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>== Debugging<br>
By default shared state async is already installed in LibreMesh, but if you want to debug you can compile the binary with debug flag enabled.<br>
First you must have a clone of openWRT with LibreMesh feeds installed. Please refer to LibreMesh docs to achieve this.</p>
</div>
<div class="listingblock">
<div class="title">Build with debugging enabled</div>
<div class="content">
<pre>make package/feeds/libremesh/shared-state-async/clean package/feeds/libremesh/shared-state-async/compile -j$(nproc) CONFIG_DEBUG=y</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Copy on verde e blu</div>
<div class="content">
<pre>scp -O bin/packages/mips_24kc/libremesh/shared-state-async_*.ipk root@[fe80::ea94:f6ff:fe68:3364%usbe1]:/tmp/
scp -O bin/packages/mips_24kc/libremesh/shared-state-async_*.ipk root@[fe80::6670:2ff:fede:c51e%usbe1]:/tmp/</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Install</div>
<div class="content">
<pre>opkg install --force-reinstall /tmp/shared-state-async_*.ipk</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Run with gdb</div>
<div class="content">
<pre>gdbserver :9000 shared-state-async</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Attach with remote OpenWrt gdb</div>
<div class="content">
<pre>scripts/remote-gdb [fe80::ea94:f6ff:fe68:3364%usbe0]:9000 ./build_dir/target-mips_24kc_musl/shared-state-async-*/shared-state-async

scripts/remote-gdb [fe80::6670:2ff:fede:c51e%usbe0]:9000 ./build_dir/target-mips_24kc_musl/shared-state-async-*/shared-state-async
break shared-state-async.cc:55
run listen
run sync bat-hosts fe80::ea94:f6ff:fe68:3364%br-lan
run sync bat-hosts fe80::d237:45ff:fefc:3cdd%br-lan</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Stressing the server</div>
<div class="content">
<pre>while Builds/build-lime-shared-state-async-node-Desktop-Debug/shared-state-async sync bat-hosts fe80::ea94:f6ff:fe68:3364%usbeth0; do echo ------------------------------------------------------------------- ;done

while shared-state-async sync bat-hosts fe80::ea94:f6ff:fe68:3364%br-lan; do echo ------------------------------------------------------------------- ;done</pre>
</div>
</div>
<div class="paragraph">
<p>=== Interesting Readings</p>
</div>
<div class="paragraph">
<p><a href="https://openwrt.org/docs/guide-developer/gdb" class="bare">https://openwrt.org/docs/guide-developer/gdb</a></p>
</div>
<div class="paragraph">
<p>VoCore2: Develop for OpenWrt on Qt Creator<br>
<a href="https://vonger.cn/?p=14657" class="bare">https://vonger.cn/?p=14657</a></p>
</div>
<div class="paragraph">
<p>== Contributing</p>
</div>
<div class="paragraph">
<p>We welcome contributions to improve Shared State and its applications. Feel free to open issues or submit pull requests on the [GitHub repository](<a href="https://github.com/LibreMesh/lime-packages" class="bare">https://github.com/LibreMesh/lime-packages</a>)</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="makefile">Makefile</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="make"><span class="c"># Shared State
#
# Copyright (C) 2023-2024  Gioacchino Mazzurco &lt;gio@eigenlab.org&gt;
# Copyright (c) 2023  Javier Jorge &lt;jjorge@inti.gob.ar&gt;
# Copyright (c) 2023  Instituto Nacional de Tecnología Industrial
# Copyright (C) 2023-2024  Asociación Civil Altermundi &lt;info@altermundi.net&gt;
#
# This program is free software: you can redistribute it and/or modify it under
# the terms of the GNU Affero General Public License as published by the
# Free Software Foundation, version 3.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
# FOR A PARTICULAR PURPOSE.
# See the GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program. If not, see &lt;https://www.gnu.org/licenses/&gt;
#
# SPDX-License-Identifier: AGPL-3.0-only
</span>
<span class="k">include</span><span class="sx"> $(TOPDIR)/rules.mk</span>

<span class="nv">PKG_NAME</span><span class="o">:=</span>shared-state-async

<span class="nv">PKG_SOURCE_PROTO</span><span class="o">:=</span>git
<span class="nv">PKG_SOURCE_URL</span><span class="o">:=</span>https://github.com/libremesh/shared-state-async.git
<span class="nv">PKG_SOURCE_DATE</span><span class="o">:=</span>2024-05-13
<span class="nv">PKG_SOURCE_VERSION</span><span class="o">:=</span>db58e3d16e8658417956f9bb42e7e87f6aadcd4d
<span class="nv">PKG_MAINTAINER</span><span class="o">:=</span>Asociación Civil Altermundi &lt;info@altermundi.net&gt;
<span class="nv">PKG_LICENSE</span><span class="o">:=</span>AGPL-3.0

<span class="c"># tar.xz or tar.zst
</span><span class="nv">PKG_XZ</span><span class="o">=</span><span class="p">$(</span>shell <span class="nv">top</span><span class="o">=</span><span class="s2">"</span><span class="p">$(</span><span class="s2">TOPDIR</span><span class="p">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">grep</span> <span class="nt">-q</span> openwrt-23.05 <span class="p">$${</span>top<span class="p">}</span>/feeds.conf.default <span class="o">&amp;&amp;</span> <span class="nb">echo true</span><span class="p">)</span>
<span class="k">ifeq</span> <span class="nv">($(PKG_XZ),true)</span>
<span class="nv">PKG_MIRROR_HASH</span><span class="o">:=</span>35884a57e26058c6534b25c50b9aef14df81da501be1d153a9bb7923a47154dd
<span class="k">else</span>
<span class="nv">PKG_MIRROR_HASH</span><span class="o">:=</span>649c977e5d32fe232c8d0cb617ec04c6e4bd767dfac40ebcdb1630ab990fcd8f
<span class="k">endif</span>

<span class="nv">GIT_COMMIT_DATE</span><span class="o">:=</span><span class="p">$(</span>shell <span class="nv">psd</span><span class="o">=</span><span class="s2">"</span><span class="p">$(</span><span class="s2">PKG_SOURCE_DATE</span><span class="p">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="p">$${</span>psd<span class="p">}</span> | <span class="nb">sed</span> <span class="s1">'s|-|.|g'</span> <span class="p">)</span>
<span class="nv">GIT_COMMIT_SHORTHASH</span><span class="o">:=</span><span class="p">$(</span>shell <span class="nv">psv</span><span class="o">=</span><span class="s2">"</span><span class="p">$(</span><span class="s2">PKG_SOURCE_VERSION</span><span class="p">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="p">$${</span>psv:0:7<span class="p">}</span> <span class="p">)</span>
<span class="nv">PKG_VERSION</span><span class="o">:=</span><span class="p">$(</span>GIT_COMMIT_DATE<span class="p">)</span>~<span class="p">$(</span>GIT_COMMIT_SHORTHASH<span class="p">)</span>
<span class="nv">PKG_RELEASE</span><span class="o">:=</span>1

<span class="nv">HOST_BUILD_PREFIX</span><span class="o">:=</span><span class="p">$(</span>STAGING_DIR_HOST<span class="p">)</span>

<span class="k">include</span><span class="sx"> $(INCLUDE_DIR)/package.mk</span>
<span class="k">include</span><span class="sx"> $(INCLUDE_DIR)/cmake.mk</span>
<span class="k">include</span><span class="sx"> $(INCLUDE_DIR)/host-build.mk</span>

<span class="k">define</span> <span class="nv">Package/$(PKG_NAME)</span>
	<span class="nv">TITLE</span><span class="o">:=</span>shared-state C++ async re-implementation
	<span class="nv">CATEGORY</span><span class="o">:=</span>LibreMesh
	<span class="c"># TODO: Statically linking libstdcpp instead of depending on it and then
</span>	<span class="c"># stripping unused symbols might reduce space usage, until this is the
</span>	<span class="c"># only package to use it
</span>	<span class="nv">DEPENDS</span><span class="o">:=</span>+libstdcpp
<span class="k">endef</span>

<span class="k">define</span> <span class="nv">Package/$(PKG_NAME)/description</span>
	<span class="err">shared-state</span> <span class="err">re-written</span> <span class="err">in</span> <span class="err">C++20</span> <span class="err">and</span> <span class="err">corotuines</span> <span class="err">to</span> <span class="err">handle</span> <span class="err">information</span> <span class="err">exchange</span> <span class="err">between</span> <span class="err">network</span> <span class="err">nodes</span> <span class="err">more</span> <span class="err">efficiently.</span>
<span class="k">endef</span>

<span class="c"># Otherwise OpenWrt's CPPFLAGS are ignored
</span><span class="nv">TARGET_CFLAGS</span> <span class="o">+=</span> <span class="p">$(</span>TARGET_CPPFLAGS<span class="p">)</span>

<span class="nv">CMAKE_OPTIONS</span> <span class="o">+=</span> <span class="nt">-DCMAKE_VERBOSE_MAKEFILE</span><span class="o">=</span>ON

<span class="c"># Disable Cpptrace as it depends on zlib and doesn't seems to work anyway on
# OpenWrt even with CONFIG_DEBUG=y it prints out
# Stack trace (most recent call first):
# #0 0x00000000
# #1 0x00000000
# #2 0x00000000
</span><span class="nv">CMAKE_OPTIONS</span> <span class="o">+=</span> <span class="nt">-DSS_CPPTRACE_STACKTRACE</span><span class="o">=</span>OFF


<span class="k">define</span> <span class="nv">Package/$(PKG_NAME)/install</span>
	<span class="err">$(INSTALL_DIR)</span> <span class="err">$(1)/usr/bin</span>
	<span class="err">$(INSTALL_BIN)</span> <span class="err">$(PKG_BUILD_DIR)/shared-state-async</span> <span class="err">$(1)/usr/bin/</span>
	<span class="err">$(CP)</span> <span class="err">./files/*</span> <span class="err">$(1)/</span>

	<span class="c"># TODO: Remove this line once discovery is reimplemented in C++
</span>	<span class="err">$(CP)</span> <span class="err">../shared-state/files/usr/bin/shared-state-get_candidates_neigh</span> <span class="err">$(1)/usr/bin/shared-state-async-discover</span>
<span class="k">endef</span>

<span class="nf">$(</span><span class="nb">eval</span> <span class="p">$(</span>call BuildPackage,<span class="p">$(</span>PKG_NAME<span class="p">)))</span></code></pre>
</div>
</div>
</div>
</div>
</div>
      <script src="/assets/js/jquery.js"></script>

<script>
$(document).ready(function() {

    var toc = $('#nav-toc');

    // Select each header
    sections = $('#md-container-pancakes h2');
        $.each(sections, function(idx, v) {
            section = $(v);
            // console.log(section)

            var div_id = $(section).attr('id');
            var div_text = section.text().split('¶')[0];
            var parent = $("#" + div_id)
            var content = '<li id="link_' + div_id + '" class="md-nav__item"><a class="md-nav__link" href="#' + div_id + '" title="' + div_text +'">' + div_text +'</a></li>';
            $(toc).append(content);

            // Add section code to subnavigation
            var children = $('<nav class="md-nav"><ul class="md-nav__list"></nav></ul>')
            var contenders = $("#" + div_id).nextUntil( "h2" );
            $.each(contenders, function(idx, contender){
               if($(contender).is('h2')) {
                   var contender_id = $(contender).attr('id');
                   var contender_text = $(contender).text().split('¶')[0];
                   var content = '<li class="md-nav__item"><a class="md-nav__link" href="#' + contender_id + '" title="' + contender_text +'">' + contender_text +'</a></li>';
                   children.append(content);
                }
             })
             $("#link_" + div_id).append(children);
        });

    });
</script>

      <!-- this will parse through the header fields and add a button to open
     an issue / ask a question on Github. The editable field should be in
     the post frontend matter, and refer to the label to open the issue for -->

<style>
.more {
    float:right;
    font-size: 1.2rem !important;
}
.more:hover {
    color: cornflowerblue !important;
}

.dropdown {
    position: relative;
    display: inline-block;
}

.dropdown i { font-size: 1.6rem !important;}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    font-weight: 200;
    box-shadow: 0px 8px 6px 0px rgba(0,0,0,0.2);
    padding: 0px 10px;
    z-index: 1;
    
}

.dropdown:hover .dropdown-content {
    display: block;
}
</style>
<script>
$(document).ready(function() {

    var divs = $("#h1,h2,h3,h4"); 
    $.each(divs, function(i,e){

        // Edit
        var did = $(e).attr('id');
        var start = '<div class="dropdown more"><span><i class="fa fa-ellipsis-h more" title="Edit"></i></span><div class="dropdown-content">';

        // Edit (assuming deployed under main organization repo)
        var link = "https://github.com/libremesh/libremesh.github.io/edit/master/packages/shared-state-async.txt#" + did;
        var button = "<p><a href='" + link + "' target='_blank'>Edit this page</a></p>";
        start += button;

        // Issues;
        var link = "https://github.com/libremesh/libremesh.github.io/issues/new?labels=question&title=Question:&body=Question on: https://github.com/libremesh/libremesh.github.io/tree/master/packages/shared-state-async.txt%23" + did;

        var button = "<p><a href='" + link + "' target='_blank'>Ask a Question</a></p>";
        start += button;
        start += "</div></div>";
        $(e).append(start)

    })
});
</script>

    </article>
</div>      

                </div>
            </div>
        </main>
    </div>
    <footer class="c-footer md-footer-nav">
  <div class="u-container c-footer__container">
    <nav class="md-footer-nav__inner md-grid">
         
      </nav>
    </div>
  
   <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2025 - LibreMesh
          </div>        
      </div>
      
        
  <div class="md-footer-social">
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> -->
      <a href="https://github.com/libremesh" target="_blank" class="md-footer-social__link fa-brands fa-github"></a>
      <a href="https://matrix.to/#/#libremesh-dev:matrix.guifi.net" target="_blank" class="md-footer-social__link fa fa-comments"></a>
      <a href="https://www.autistici.org/mailman/listinfo/libremesh" target="_blank" class="md-footer-social__link fa fa-envelope"></a>
      
  </div>

    </div>
  </div>

</footer>


    <script>
  var headers = ["h1", "h2", "h3", "h4"]
  var colors = ["var(--color-primary)", "orange", "green", "blue"]
  
  $.each(headers, function(i, header){
    //   var color = colors[i];
      var color = colors[0];
      $(header).each(function () {
          var href=$(this).attr("id");
          $(this).append('<a class="headerlink" style="color:' + color + '" href="#' + href + '" title="Permanent link">¶</a>')
      });
  })
  
  </script>
  
    

  </body>
</html>
